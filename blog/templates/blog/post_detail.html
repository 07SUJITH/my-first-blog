{% extends 'blog/base.html' %}
{% load static %}

{% block title %}
{% if post %}{{ post.title }} - Modern Blog{% else %}Post Not Found - Modern Blog{% endif %}
{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{% static 'blog/css/blog_detail.css' %}">
{% endblock %}

{% block content %}
{% if post.published_date %}
<a style="margin-top: 10px;"
    href="{% url 'blog:post_list' %}{% if request.GET.from_page %}?page={{ request.GET.from_page }}{% endif %}"
    class="back-button">
    ← Back to Posts
</a>
{% else %}
<a style="margin-top: 10px;"
    href="{% url 'blog:post_draft_list' %}{% if request.GET.from_page %}?page={{ request.GET.from_page }}{% endif %}"
    class="back-button">
    ← Back to Drafts
</a>
{% endif %}

{% if post %}
<article class="article">
    <header class="article-header">
        <h1 class="article-title">{{ post.title }}</h1>
        <div class="article-meta">
            <div class="author-info">
                <div class="author-avatar">
                    {{ post.author.first_name|first|default:post.author.username|first|upper }}
                </div>
                <div class="author-details">
                    <h4>{{ post.author.get_full_name|default:post.author.username }}</h4>
                    {% if post.published_date %}
                    <div class="publish-date">
                        Published on {{ post.published_date|date:"F d, Y" }}
                    </div>
                    {% else %}
                    <div class="publish-date">
                        Created at {{ post.created_date|date:"F d, Y" }}
                    </div>

                    {% endif %}

                </div>
            </div>
            <aside class="actions">
                {% if user.is_authenticated %}
                <a class="btn btn-secondary" href="{% url 'blog:post_edit' pk=post.pk %}">
                    {% include './icons/pencil-fill.svg' %}
                </a>

                {% if post.published_date == None %}
                <form method="POST" action="{% url 'blog:post_publish' pk=post.pk %}" class="post-form">{% csrf_token %}
                    <button type="submit" class="submit-btn submit-btn-secondary" name="publish">Publish</button>
                </form>
                {% endif %}
                <form method="POST" action="{% url 'blog:post_remove' pk=post.pk %}" class="post-form">{% csrf_token %}
                    <button type="submit" class="submit-btn btn-danger" name="delete">Delete</button>
                </form>
                {% endif %}
            </aside>
        </div>
    </header>
    <div class="article-content">
        {{ post.text|linebreaks }}
    </div>
</article>
{% else %}
<div class="error-message">
    <h2>Post Not Found</h2>
    <p>Sorry, the post you're looking for doesn't exist or hasn't been published yet.</p>
    <p>Try browsing our <a href="{% url 'blog:post_list' %}">recent articles</a>.</p>
</div>
{% endif %}
{% endblock %}